
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Develop &#8212; emtf-book</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Documentation" href="docs.html" />
    <link rel="prev" title="Usage" href="usage.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">emtf-book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   EMTF++ Documentation
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="usage.html">
   Usage
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Develop
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="docs.html">
   Documentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="misc.html">
   Misc
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/develop.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/jiafulow/emtf-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/jiafulow/emtf-book/issues/new?title=Issue%20on%20page%20%2Fdevelop.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-guide">
   How-to Guide
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-convert-the-private-ntuples-into-numpy-arrays">
     How to convert the private ntuples into NumPy arrays?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-set-up-the-conda-environment">
     How to set up the Conda environment?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-get-the-jupyter-notebooks">
     How to get the Jupyter notebooks?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-generate-the-patterns">
     How to generate the patterns?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-train-the-nn">
     How to train the NN?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-import-the-patterns-and-the-nn-into-the-hls-source-code-and-the-emulator-code">
     How to import the patterns and the NN into the HLS source code and the emulator code?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-make-rate-and-efficiency-plots">
     How to make rate and efficiency plots?
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="develop">
<h1>Develop<a class="headerlink" href="#develop" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This section describes how to generate the patterns, how to train the NN, and how to include the updates into the HLS source code and the emulator code. It also describes how to make the rate and efficiency plots.</p>
<p>Most of the tasks here are done with Python + Jupyter. A Conda environment is used to manage the Python packages. NumPy is used extensively. The ML framework of choice is TensorFlow. The tasks are executed by running the Jupyter notebooks.</p>
<p>If you are not familiar with Jupyter, please look at:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://jupyter.readthedocs.io/en/latest/content-quickstart.html">Get Started - Jupyter Documentation</a></p></li>
</ul>
<p>If you are not familiar with Conda, please look at:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://conda.io/projects/conda/en/latest/user-guide/getting-started.html">Getting started with conda</a></p></li>
</ul>
<p>If you are not familiar with NumPy, please look at:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://numpy.org/doc/stable/user/absolute_beginners.html">NumPy: the absolute basics for beginners</a></p></li>
</ul>
<p>If you are not familiar with TensorFlow, please look at:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.tensorflow.org/tutorials">Tutorials | TensorFlow Core</a></p></li>
</ul>
</div>
<div class="section" id="how-to-guide">
<h2>How-to Guide<a class="headerlink" href="#how-to-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-to-convert-the-private-ntuples-into-numpy-arrays">
<h3>How to convert the private ntuples into NumPy arrays?<a class="headerlink" href="#how-to-convert-the-private-ntuples-into-numpy-arrays" title="Permalink to this headline">¶</a></h3>
<p>Before doing any of the tasks here, the private ntuples need to be converted into NumPy arrays. This step has dependency on ROOT, and thus CMSSW; but after the conversion, you will no longer have dependency on ROOT and CMSSW.</p>
<p>First, follow the set up instructions as used for <a class="reference external" href="usage.html#how-to-make-private-ntuples">How to make private ntuples</a>.</p>
<p>Then, change directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$CMSSW_BASE</span>/src/L1TMuonSimulations/Analyzers/workspace/
</pre></div>
</div>
<p>The location of the ntuples are hardcoded in the script <code class="docutils literal notranslate"><span class="pre">emtf_ntuples.py</span></code>. Look at <code class="docutils literal notranslate"><span class="pre">SingleMuon</span></code> for particle gun ntuples, and <code class="docutils literal notranslate"><span class="pre">SingleNeutrinoPU200</span></code> for neutrino PU200 ntuples. You should modify them if necessary.</p>
<p>Then, in the script <code class="docutils literal notranslate"><span class="pre">ristretto.py</span></code>, select <code class="docutils literal notranslate"><span class="pre">analysis</span> <span class="pre">=</span> <span class="pre">'signal'</span></code> if running on particle gun ntuples (default), or select <code class="docutils literal notranslate"><span class="pre">analysis</span> <span class="pre">=</span> <span class="pre">'bkgnd'</span></code> if running on neutrino PU200 ntuples. Then, run it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python ristretto.py
</pre></div>
</div>
</div>
<div class="section" id="how-to-set-up-the-conda-environment">
<h3>How to set up the Conda environment?<a class="headerlink" href="#how-to-set-up-the-conda-environment" title="Permalink to this headline">¶</a></h3>
<p>For the rest of the tasks, it’s best to avoid any CMSSW dependency. A Conda environment is used instead. See <a class="reference external" href="https://conda.io/projects/conda/en/latest/user-guide/getting-started.html">Getting started with conda</a> to figure out how to install Conda.</p>
<p>First, create the following YAML file <code class="docutils literal notranslate"><span class="pre">conda-tf-environment.yml</span></code>:</p>
<details class="sphinx-bs dropdown card mb-3">
<summary class="summary-title card-header">
Content of <code class="docutils literal notranslate"><span class="pre">conda-tf-environment.yml</span></code><div class="summary-down docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="summary-up docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="summary-content card-body docutils">
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tf</span>
<span class="nt">channels</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">defaults</span>
<span class="nt">dependencies</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">more-itertools</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">jupyterlab</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">jupyter</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">seaborn</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">python=3.9</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">numpy</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pyyaml</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">matplotlib</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">scipy</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">h5py</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dask</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pandas</span>
</pre></div>
</div>
</div>
</details><p>Then, create the Conda environment with the selected Python packages using the YAML file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda update --yes -n base conda
conda env create --file conda-tf-environment.yml
</pre></div>
</div>
<p>Then, install TensorFlow via pip:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda activate tf
pip install -U pip
pip install -U <span class="nv">tensorflow</span><span class="o">=</span><span class="m">2</span>.6.0
</pre></div>
</div>
<p>For the sake of consistency, it is recommeded to stay with TensorFlow <code class="docutils literal notranslate"><span class="pre">v2.6.0</span></code> rather than using the latest version.</p>
<p>Finally, install this EMTF++ Python package (unpublished):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone git@github.com:jiafulow/emtf-nnet.git
<span class="nb">cd</span> emtf-nnet
pip install -U -e .
</pre></div>
</div>
</div>
<div class="section" id="how-to-get-the-jupyter-notebooks">
<h3>How to get the Jupyter notebooks?<a class="headerlink" href="#how-to-get-the-jupyter-notebooks" title="Permalink to this headline">¶</a></h3>
<p>The notebooks are stored in this repository:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/jiafulow/user-notebooks/tree/L1MuonTrigger-P2_11_1_7">https://github.com/jiafulow/user-notebooks/tree/L1MuonTrigger-P2_11_1_7</a></p></li>
</ul>
<p>Please refer to <code class="docutils literal notranslate"><span class="pre">README.md</span></code> in the repo for details.</p>
</div>
<div class="section" id="how-to-generate-the-patterns">
<h3>How to generate the patterns?<a class="headerlink" href="#how-to-generate-the-patterns" title="Permalink to this headline">¶</a></h3>
<p>In the Notebooks directory, execute the notebooks: <code class="docutils literal notranslate"><span class="pre">10-patterns-zone0.ipynb</span></code>, <code class="docutils literal notranslate"><span class="pre">11-patterns-zone1.ipynb</span></code>, and <code class="docutils literal notranslate"><span class="pre">12-patterns-zone2.ipynb</span></code>. Set the variables <code class="docutils literal notranslate"><span class="pre">signal_fname</span></code> and <code class="docutils literal notranslate"><span class="pre">bkgnd_fname</span></code> in these notebooks to be the locations of the NumPy arrays (converted from the private ntuples).</p>
<p>They will produce: <code class="docutils literal notranslate"><span class="pre">patterns_zone0.npz</span></code>, <code class="docutils literal notranslate"><span class="pre">patterns_zone1.npz</span></code>, and <code class="docutils literal notranslate"><span class="pre">patterns_zone2.npz</span></code>, respectively.</p>
</div>
<div class="section" id="how-to-train-the-nn">
<h3>How to train the NN?<a class="headerlink" href="#how-to-train-the-nn" title="Permalink to this headline">¶</a></h3>
<p>In the Notebooks directory, execute the notebooks: <code class="docutils literal notranslate"><span class="pre">21-features-full.ipynb</span></code>. Set the variables <code class="docutils literal notranslate"><span class="pre">signal_fname</span></code> and <code class="docutils literal notranslate"><span class="pre">bkgnd_fname</span></code> in these notebooks to be the locations of the NumPy arrays (converted from the private ntuples).
It will produce <code class="docutils literal notranslate"><span class="pre">features.h5</span></code>, which is used as input to the next step.</p>
<p>Then, execute the notebooks: <code class="docutils literal notranslate"><span class="pre">22-predictions.ipynb</span></code> and <code class="docutils literal notranslate"><span class="pre">23-predictions-quant.ipynb</span></code>. Set the variable <code class="docutils literal notranslate"><span class="pre">features_fname</span></code> in these notebooks to be the location of the output file from the previous step. The difference between the two notebooks is that the first notebook does not apply NN quantization, while the second notebook does.</p>
<p>The first notebook will produce <code class="docutils literal notranslate"><span class="pre">nnet_model.json</span></code> and <code class="docutils literal notranslate"><span class="pre">nnet_model_weights.h5</span></code>; the second notebook will produce <code class="docutils literal notranslate"><span class="pre">quant_nnet_model.json</span></code> and <code class="docutils literal notranslate"><span class="pre">quant_nnet_model_weights.h5</span></code>.</p>
</div>
<div class="section" id="how-to-import-the-patterns-and-the-nn-into-the-hls-source-code-and-the-emulator-code">
<h3>How to import the patterns and the NN into the HLS source code and the emulator code?<a class="headerlink" href="#how-to-import-the-patterns-and-the-nn-into-the-hls-source-code-and-the-emulator-code" title="Permalink to this headline">¶</a></h3>
<p>In the Notebooks directory, execute the notebook: <code class="docutils literal notranslate"><span class="pre">20-features-quick.ipynb</span></code>. Make some edits in the notebook:</p>
<ul class="simple">
<li><p>Set the variables <code class="docutils literal notranslate"><span class="pre">signal_fname</span></code> and <code class="docutils literal notranslate"><span class="pre">bkgnd_fname</span></code> to be the locations of the NumPy arrays (converted from the private ntuples).</p></li>
<li><p>Set the variable <code class="docutils literal notranslate"><span class="pre">patterns_fname</span></code> to be the location of the patterns file (e.g. <code class="docutils literal notranslate"><span class="pre">patterns_zone0.npz</span></code>).</p></li>
<li><p>Set the variable <code class="docutils literal notranslate"><span class="pre">nnet_model_fname</span></code> to be the location of the NN model file (e.g. <code class="docutils literal notranslate"><span class="pre">quant_nnet_model.json</span></code>)</p></li>
</ul>
<p>The notebook will produce several JSON files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pattern_bank.json</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nnet_weights.json</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x_test_sparse.json</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extracted_zonemerging_0.json</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extracted_trkbuilding_0.json</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extracted_duperemoval_0.json</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extracted_trainfilter_0.json</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extracted_fullyconnect_0.json</span></code></p></li>
</ul>
<p>Change directory to the working area for HLS source code. See <a class="reference external" href="usage.html#how-to-set-up-the-hls-source-code">How to set up the HLS source code</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> &lt;hls-working-area&gt;
</pre></div>
</div>
<p>Then, copy the above files to the directory <code class="docutils literal notranslate"><span class="pre">scripts</span></code>. The scripts in this directory can be used to automatically write HLS source code and test bench files:</p>
<ul class="simple">
<li><p>Do <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">make_pattern_bank.py</span></code> to generate the header file <code class="docutils literal notranslate"><span class="pre">pattern_bank.h</span></code>. Move it to the directory <code class="docutils literal notranslate"><span class="pre">firmware/emtf_hlslib/</span></code>.</p></li>
<li><p>Do <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">make_nnet_weights.py</span></code> to generate the header file <code class="docutils literal notranslate"><span class="pre">nnet_weights.h</span></code>. Move it to the directory <code class="docutils literal notranslate"><span class="pre">firmware/emtf_hlslib/</span></code>.</p></li>
<li><p>Do <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">make_testbench.py</span></code> to generate all the test bench files. Move them to the appropriate locations by following the instruction shown by the script.</p></li>
</ul>
<p>Check that the import is successful by running on of the Tcl scripts.</p>
</div>
<div class="section" id="how-to-make-rate-and-efficiency-plots">
<h3>How to make rate and efficiency plots?<a class="headerlink" href="#how-to-make-rate-and-efficiency-plots" title="Permalink to this headline">¶</a></h3>
<p>(This workflow is kind of tedious at the moment.)</p>
<p>If the patterns or the NN are updated, the emulator code should be updated and re-compiled.</p>
<p>Run the emulator and make the private ntuples for neutrino PU200 dataset (used for rate estimation) and muon PU200 dataset (used for efficiency estimation). See <a class="reference external" href="usage.html#how-to-make-private-ntuples">How to make private ntuples</a>.</p>
<p>Convert the private ntuples into NumPy arrays by using the script <code class="docutils literal notranslate"><span class="pre">espresso.py</span></code>. In the script <code class="docutils literal notranslate"><span class="pre">espresso.py</span></code>, select <code class="docutils literal notranslate"><span class="pre">analysis</span> <span class="pre">=</span> <span class="pre">'rates'</span></code> if running on neutrino PU200 ntuples (default), or <code class="docutils literal notranslate"><span class="pre">analysis</span> <span class="pre">=</span> <span class="pre">'effie'</span></code> if running on muon PU200 ntuples. Then, run it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python espresso.py
</pre></div>
</div>
<p>Go to the Notebooks directory, execute the notebooks: <code class="docutils literal notranslate"><span class="pre">30-rates.ipynb</span></code> and <code class="docutils literal notranslate"><span class="pre">31-efficiency.ipynb</span></code>. Set the variable <code class="docutils literal notranslate"><span class="pre">rates_fname</span></code> and <code class="docutils literal notranslate"><span class="pre">effie_fname</span></code> in these notebooks to be the location of the NumPy arrays.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="usage.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Usage</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="docs.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Documentation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Jia Fu Low<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>